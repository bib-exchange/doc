### 签名说明

API 请求在通过 internet 传输的过程中极有可能被篡改，为了确保请求未被更改，除公共接口（基础信息，行情数据）外的私有接口均必须使用您的 API Key 做签名认证，以校验参数或参数值在传输途中是否发生了更改。

待签名字符串的结构为：请求发起的时间戳+请求方法（GET或POST）+请求路由（去掉http协议以及域名后的资源访问符）+请求参数（GET请求直接携带在url上，post请求需要将请求的body进行压缩）。以上所有结构最终拼接成一个没有空格以及换行的字符串。

在发起一个需要验签的请求时，请求头必须携带以下参数

X-CH-APIKEY：即API Public Key

X-CH-SIGN：签名计算得出的值，用于确保签名有效和未被篡改

X-CH-TS：时间戳毫秒数，用于防止第三方截取您的请求。因为时间戳本身也作为参与签名的参数，所以要保障这里携带的时间戳和参与签名的时间戳完全一致

### 创建API KEY

您可以在 [这里](https://www.bibkvip.com/zh_CN/personal/apiManagement) 创建API KEY

API KEY 包含以下两个部分

- API Public Key：API访问公钥
- Secret Key：签名认证所使用的密钥（需使用谷歌验证码验证后可见）

~~~
创建API KEY时需绑定IP地址，多个IP地址间使用","（英文输入法下的逗号）分隔。无法从绑定的IP之外的服务器上使用此密钥。创建API KEY后可申请修改绑定IP地址
~~~

~~~
API KEY具有交易、查询权限，不具有充提币权限
~~~

~~~
这两个密钥与账号安全紧密相关，无论合适都请勿向其他人透露
~~~

### 签名步骤

合约API的签名使用HMAC进行签名计算，哈希算法使用SHA256，直接取16位（这里指HEX，不是计算结果截取16位字符串）的计算结果作为签名字符串

因为使用不同内容计算得到的结果会完全不同，所以在进行签名计算前，请先对请求进行规范化处理，下面分别以查询用户某币对的仓位以及批量下单为例分别介绍GET和POST请求签名方法

#### 查询账户余额请求（GET）

`http://futures-open-api.bibk8suat.com/fapi/v1/positions?contractName=E-BTC-USDT`

##### 1.请求时间戳

`1690172300000`

##### 2.请求方法（GET）

待签名字符拼接 `1690172300000GET`

##### 3.请求路由 

待签名字符拼接 `1690172300000GET/fapi/v1/positions`

##### 4.请求参数 

按照ASCII码的顺序对参数名进行排序后拼接，此处距离仅一个参数故无需排序直接拼接

待签名字符拼接 `1690172300000GET/fapi/v1/positions?contractName=E-BTC-USDT`

##### 5.签名

使用密钥12e59f1bee4e5b353698670549ce64cc（这里的密钥仅提供作为举例验证使用，正式环境中请使用自己申请的密钥，此密钥无法使用）做基于SHA256的认证计算后得到签名

`c94693a01fc3aa452b76ed4e31bc300970b267b5810f04b4f1cb08770a4b994c`

##### 6.请求示例

将API Public Key、时间戳、签名添加到http请求参数中，最终得到如下请求：

~~~shell
curl --request GET 'http://futures-open-api.bibk8suat.com/fapi/v1/positions?contractName-E-BTC-USDT' \
--header 'X-CH-APIKEY: 06833aff9e695f50edd31137923f79d8' \
--header 'X-CH-TS: 1690172300000' \
--header 'X-CH-SIGN: c94693a01fc3aa452b76ed4e31bc300970b267b5810f04b4f1cb08770a4b994c' \
~~~

#### 批量下单请求（POST）

`http://futures-open-api.bibk8suat.com/fapi/v1/batchRobot`

请求参数body

~~~json
{
	"contractName": "E-BTC-USDT",
	"orders": [{
        "open": "OPEN",
		"positionType": 1,
		"price": 29750.00,
		"clientOrderId": "waynee",
		"contractName": "E-BTC-USDT",
		"side": "SELL",
		"type": "LIMIT",
		"volume": 200
	}]
}
~~~

##### 1.请求时间戳

待签名字符拼接 `1690268066000`

##### 2.请求方法（POST）

待签名字符拼接 `1690268066000POST`

##### 3.请求路由

待签名字符拼接 `1690268066000POST/fapi/v1/batchRobot`

##### 4.请求参数

需要先对请求参数做ASCII排序，得到排序后的结果为

~~~json
{
	"contractName": "E-BTC-USDT",
	"orders": [{
		"clientOrderId": "waynee",
		"contractName": "E-BTC-USDT",
		"open": "OPEN",
		"positionType": 1,
		"price": 29750.00,
		"side": "SELL",
		"type": "LIMIT",
		"volume": 200
	}]
}
~~~

对排序后的结果进行压缩，得到的结果为

~~~json
{"contractName":"E-BTC-USDT","orders":[{"clientOrderId":"waynee","contractName":"E-BTC-USDT","open":"OPEN","positionType":1,"price":29750.00,"side":"SELL","type":"LIMIT","volume":200}]}
~~~

待签名字符拼接

`1690268066000POST/fapi/v1/batchRobot{"contractName":"E-BTC-USDT","orders":[{"clientOrderId":"waynee","contractName":"E-BTC-USDT","open":"OPEN","positionType":1,"price":29750.00,"side":"SELL","type":"LIMIT","volume":200}]}`

##### 5.签名

使用密钥12e59f1bee4e5b353698670549ce64cc（这里的密钥仅提供作为举例验证使用，正式环境中请使用自己申请的密钥，此密钥无法使用）做基于SHA256的认证计算后得到签名

`4f6998cbe1687e64821f77ebb99301890b9ad2f33b8f4042ce9c54331582c889`

##### 6.请求示例

将API Public Key、时间戳、签名添加到http请求参数中，最终得到如下请求：

~~~shell
curl --request POST 'http://futures-open-api.bibk8suat.com/fapi/v1/batchRobot' \
--header 'X-CH-APIKEY: 06833aff9e695f50edd31137923f79d8' \
--header 'X-CH-TS: 1690268066000' \
--header 'X-CH-SIGN: 4f6998cbe1687e64821f77ebb99301890b9ad2f33b8f4042ce9c54331582c889' \
--header 'Content-Type: application/json' \
--data-raw '{"contractName":"E-BTC-USDT","orders":[{"clientOrderId":"waynee","contractName":"E-BTC-USDT","open":"OPEN","positionType":1,"price":29750.00,"side":"SELL","type":"LIMIT","volume":200}]}'
~~~

